<% title = "Show Review"
   title += " &gt; " + @changeset.name if not @changeset.nil? %>
<% content_for :page_name, title.html_safe %>

<div id="create-changeset-dialog" class="hidden">
  <% if @review_event.changesets.size > 0 %>
    <div class="info"><strong>Note:</strong> Creating a new changeset will 
    reset the status of your review, and all assigned reviewers will be 
    notified.</div>
  <% end %>
  <%= form_for :changeset do |f| %>
    <%= f.label :name, "Name (optional)", :style => "display:block;" %>
    <%= f.text_field :name, :style => "width:20em;", 
        :class => "text ui-corner-all ui-widget-content" %>
    <%= f.hidden_field :review_event_id, :value => @review_event.id %>
  <% end %>
</div>

<div id="submit-changeset-dialog" class="hidden">
  Are you sure you wish to submit this revision for review?
  <%= form_for :changeset do |f| %>
    <%= f.hidden_field :submitted, :value => true %>
  <% end %>
</div>

<div id="remove-changeset-dialog" class="hidden">
  Are you sure you wish to remove this changeset?
</div>

<div id="status-changeset-dialog" class="hidden"></div>

<% if not @changeset.nil? %>
  <div id="add-diff-dialog" class="hidden">
    <div class="info">Create a unified diff with the command
    <pre>diff -ru &lt;old&gt; &lt;new&gt;</pre>
    and paste its contents here:</div>
    <%= form_for :diff do |f| %>
      <%= f.hidden_field :changeset_id, :value => @changeset.id %>
      <%= f.label :contents, :value => "Diff" %>
      <%= f.text_area :contents, :rows => 5, 
          :class => "text ui-corner-all ui-widget-content",
          :style => "width:97%" %>
    <% end %>
  </div>

  <div id="remove-diff-dialog" class="hidden">
    Are you sure you wish to remove this diff?
  </div>
<% end %>

<div class="review">
  <div style="float:right; padding:0.2em 0.2em 0;">
    <% if current_user == @review_event.owner %>
      <%= link_to edit_review_event_path(@review_event), 
          :class => "ui-state-default ui-corner-all button" do %>
        <span class="ui-icon ui-icon-pencil left"></span>Edit
      <% end %>
    <% elsif @status.nil? and @review_event.reviewers.include?(current_user) %>
      <%= link_to_js "submit_changeset_status('#{@changeset.id}', true);",
          :class => "ui-state-default ui-corner-all button" do %>
        <span class="ui-icon ui-icon-check left"></span>
        Accept
      <% end %>
      <%= link_to_js "submit_changeset_status('#{@changeset.id}', false);",
          :class => "ui-state-default ui-corner-all button" do %>
        <span class="ui-icon ui-icon-closethick left"></span>
        Reject
      <% end %>
    <% end %>
  </div>

  <h2>
    (<%= @review_event.id %>) <strong><%= @review_event.name %></strong> 
    <span class="author">by <%= @review_event.owner.username %></span>
    <div style="clear:both;"></div>
  </h2>

  <div style="width:50%; display:inline-block; vertical-align:top;">
    <p><strong>Due Date:</strong>&nbsp;&nbsp;
      <%= @review_event.duedate.to_date if not @review_event.duedate.nil? %>
    </p>

    <p><strong>Reviewers:</strong>&nbsp;&nbsp;
      <%= @review_event.reviewers.map { |u| u.username }.join(", ") %>
    </p>

    <p>
      <strong>Notes:</strong>&nbsp;&nbsp;<%= @review_event.notes %>
    </p>
  </div>

  <div style="width:40%; display:inline-block; vertical-align:top;">
    <%= render :partial => "revisions" %>
  </div>
</div>

<% if @changeset.nil? %>
  <div class="notice">
    No changesets yet.  Click &quot;Add new changeset&quot; above to create
    one.
  </div>
<% else %>
  <%= render :partial => "status" %>
  <%= render :partial => "files" %>
  <%= render :partial => "diffs" %>
<% end %>

