<% level = 0 if level.nil? %>
<a name="<%= comment.id %>"></a>
<div class="comment" id="comment_<%= comment.id %>" style="margin-left:<%= level * 10 + 10 %>px;">
  <div class="topbar">
    <%= user_profile_popup(comment.user) %>
    <div class="right">
      <div class="comment-actions">
        <% if comment.user != current_user %>
          <%= add_comment_button comment, "#reply_#{comment.id}" do %>
            <span class="ui-icon ui-icon-arrowreturnthick-1-w inline-icon"></span>Reply<% end %>
        <% elsif comment.comments.size == 0 %>
          <a href="#" onclick="delete_comment('<%= comment.id %>'); return false;">
            <span class="ui-icon ui-icon-close inline-icon"></span>Delete</a> 
        <% else %>
          <span class="ui-icon ui-icon-locked inline-icon"></span>Locked
        <% end %>
      </div>
    </div>
  </div>
  <div class="comment-text">
    <%= comment.html_format %>
  </div>
</div>

<div id="reply_<%= comment.id %>"></div>

<% comment.comments.each do |c| %>
  <%= render :partial => "shared/comment", 
      :locals => { :comment => c, :level => level + 1 } %>
<% end %>

