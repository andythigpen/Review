<% level = 0 if level.nil? %>
<a name="<%= comment.id %>"></a>
<div class="comment" id="comment_<%= comment.id %>">
  <div>
    <div>
      <span class="author"><%= comment.user.full_name %></span> 
      <span><%= level == 0 ? "said" : "replied" %>
      <% if level > 0 %>
        to <span class="author"><%= comment.commentable.user.full_name %></span>
      <% end %>
      </span>
      <div class="comment-actions hidden right">
        <% if comment.user != current_user %>
          <%= add_comment_button comment, "#reply_#{comment.id}" do %>
            <span class="ui-icon ui-icon-arrowreturnthick-1-w inline-icon"></span>Reply
          <% end %>
        <% elsif comment.comments.size == 0 %>
          <a href="#" onclick="delete_comment('<%= comment.id %>'); return false;">
            <span class="ui-icon ui-icon-close inline-icon"></span>Delete</a> 
        <% end %>
      </div>
    </div>
    <div class="comment-text"><%= comment.html_format %></div>
  </div> 
</div>

<div id="reply_<%= comment.id %>"></div>

<% comment.comments.each do |c| %>
  <%= render :partial => "shared/comment", 
      :locals => { :comment => c, :level => level + 1 } %>
<% end %>

